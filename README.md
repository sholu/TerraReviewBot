# TerraReviewBot - AI-Powered Terraform Plan Validator

TerraReviewBot is a Flask web application that validates and analyzes Terraform plan.out files using AI. It supports binary## AI Integration with NVIDIA

TerraReviewBot now supports AI-powered analysis using NVIDIA's Llama 3.1 Nemotron model!

### Setup AI Analysis

1. **Get NVIDIA API Key:**
   - Visit https://build.nvidia.com/
   - Sign up and get your API key
   - Copy the provided API key

2. **Configure Environment:**
   ```bash
   # Copy the example environment file
   cp .env.example .env
   
   # Edit .env and add your API key
   NVIDIA_API_KEY=your_actual_api_key_here
   ```

3. **Test AI Integration:**
   ```bash
   # Test the NVIDIA API connection
   python test_nvidia_api.py
   ```

### AI Features

- **Intelligent Plan Analysis**: AI reviews your Terraform plans for security, best practices, and potential issues
- **Cost Implications**: Identifies potential cost impacts of infrastructure changes
- **Security Assessment**: Highlights security considerations and risks
- **Recommendations**: Provides actionable improvement suggestions

### Using AI Analysis

1. Upload a valid Terraform plan file (JSON or binary)
2. TerraReviewBot validates the plan structure
3. AI analysis runs automatically for valid plans
4. View comprehensive insights in the results page

### Future Enhancements

- [ ] Multi-provider AI support (OpenAI, Anthropic, etc.)
- [ ] Enhanced AI-powered plan summarization with multiple AI providers
- [ ] Support for Terraform state filesON, and text formats and provides detailed validation results with intelligent plan summaries.

## Features

- **Multi-format Support**: Handles Terraform plan files in binary (.out), JSON (.json), and text (.txt, .plan) formats
- **Smart Detection**: Automatically detects file type and validates format
- **Plan Analysis**: Extracts and displays resource changes, providers, and configuration details
- **Modern UI**: Clean, responsive web interface with drag-and-drop file upload
- **API Endpoint**: RESTful API for programmatic validation
- **Security**: File type validation and secure file handling

## Prerequisites

- Python 3.7 or higher
- Terraform CLI (optional, for binary plan conversion)
- libmagic (for file type detection)

### Installing libmagic

**macOS:**
```bash
brew install libmagic
```

**Ubuntu/Debian:**
```bash
sudo apt-get install libmagic1
```

**Windows:**
The `python-magic-bin` package in requirements.txt includes the necessary binaries.

## Setup

1. **Clone or download the project:**
   ```bash
   cd /path/to/TerraReviewBot
   ```

2. **Create a virtual environment:**
   ```bash
   python3 -m venv venv
   source venv/bin/activate  # On Windows: venv\Scripts\activate
   ```

3. **Install dependencies:**
   ```bash
   pip install -r requirements.txt
   ```

4. **Create uploads directory:**
   ```bash
   mkdir uploads
   ```

5. **Set environment variables (optional):**
   ```bash
   export FLASK_ENV=development
   export FLASK_DEBUG=1
   ```

## Running the Application

1. **Start the Flask server:**
   ```bash
   python app.py
   ```

2. **Open your browser and navigate to:**
   ```
   http://localhost:5000
   ```

## Usage

### Web Interface

1. Visit the home page
2. Drag and drop or click to select a Terraform plan file
3. Supported formats:
   - Binary plan files (`.out`)
   - JSON plan files (`.json`)
   - Text plan files (`.txt`, `.plan`)
4. Click "Validate Plan" to analyze the file
5. View detailed validation results and plan summary

### API Endpoint

**Validate a plan file:**

```bash
curl -X POST -F "file=@path/to/plan.out" http://localhost:5000/api/validate
```

**Response format:**
```json
{
  "filename": "plan.out",
  "file_type": "binary",
  "is_valid": true,
  "message": "Valid Terraform binary plan format detected",
  "has_plan_data": true
}
```

## File Type Support

### Binary Plans (.out)
- Generated by `terraform plan -out=plan.out`
- Requires Terraform CLI for JSON conversion
- Validated by checking file headers and structure

### JSON Plans (.json)
- Generated by `terraform show -json plan.out`
- Direct JSON parsing and validation
- Full plan analysis available

### Text Plans (.txt, .plan)
- Can contain JSON-formatted plan data
- Fallback validation for text files
- Limited analysis capabilities

## Validation Process

1. **File Type Detection**: Uses python-magic to detect file MIME type
2. **Format Validation**: 
   - Binary: Checks for Terraform plan signatures
   - JSON: Validates JSON structure and Terraform-specific fields
   - Text: Attempts JSON parsing with fallback
3. **Plan Analysis**: Extracts resource changes, providers, and metadata
4. **Results Display**: Shows validation status and detailed plan summary

## Configuration

Key configuration options in `app.py`:

```python
app.config['SECRET_KEY'] = 'your-secret-key-here'  # Change this!
app.config['UPLOAD_FOLDER'] = 'uploads'
app.config['MAX_CONTENT_LENGTH'] = 16 * 1024 * 1024  # 16MB max
```

## Security Considerations

- Files are temporarily stored and immediately deleted after processing
- File type validation prevents malicious uploads
- Secure filename handling with `werkzeug.utils.secure_filename`
- Size limits prevent DoS attacks
- No persistent storage of uploaded content

## Troubleshooting

### Common Issues

1. **"Terraform CLI not found" error:**
   - Install Terraform CLI from https://www.terraform.io/downloads
   - Ensure `terraform` command is in your PATH

2. **"Magic number error" on import:**
   - Install libmagic system dependency
   - On macOS: `brew install libmagic`
   - On Ubuntu: `sudo apt-get install libmagic1`

3. **File upload fails:**
   - Check file size (max 16MB by default)
   - Verify file extension is allowed (.out, .json, .txt, .plan)
   - Ensure uploads directory exists

### Debug Mode

Enable debug mode for detailed error messages:

```bash
export FLASK_DEBUG=1
python app.py
```

## Future Enhancements

- [ ] Enhanced AI-powered plan summarization with multiple AI providers
- [ ] Support for Terraform state files
- [ ] Plan comparison functionality
- [ ] Export results to PDF/HTML
- [ ] Integration with CI/CD pipelines
- [ ] Advanced security scanning
- [ ] Multi-file batch processing

## Contributing

1. Fork the repository
2. Create a feature branch
3. Make your changes
4. Add tests if applicable
5. Submit a pull request

## License

This project is open source. Feel free to modify and distribute as needed.

## Support

For issues or questions:
1. Check the troubleshooting section
2. Review the application logs
3. Ensure all dependencies are properly installed
4. Verify Terraform CLI installation for binary plan support
